<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>SITMUN Core Angular Library documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">SITMUN Core Angular Library documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>InfoDialogData</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/main/angular-library/projects/sitmun-plugin-core/src/lib/map/feature-info-dialog.component.ts</code>
        </p>



        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#message">message</a>
                                </li>
                                <li>
                                        <a href="#title">title</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="message"></a>
                                        <span class="name"><b>message</b><a href="#message"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>message:     <code></code>
</code>
                                    </td>
                                </tr>







                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="title"></a>
                                        <span class="name"><b>title</b><a href="#title"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>title:     <code></code>
</code>
                                    </td>
                                </tr>







                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {Component, Inject, OnInit, ViewEncapsulation} from &#x27;@angular/core&#x27;;
import { FormGroup, FormBuilder } from &#x27;@angular/forms&#x27;;
import {MAT_DIALOG_DATA, MatDialogRef, MatDialog} from &quot;@angular/material&quot;;

import { HttpClient } from &#x27;@angular/common/http&#x27;;
import {TranslateService} from &#x27;@ngx-translate/core&#x27;;

import * as ol from &#x27;openlayers&#x27;;

export class FeatureInfoRequestData {
    title?:string;
    request:string;
    type?:&quot;text/xml&quot;;
}

export class FeatureInfoDialogData {
  requests: Array&lt;FeatureInfoRequestData&gt;;
}

@Component({
    selector: &#x27;feature-info-dialog&#x27;,
    templateUrl: &#x27;./feature-info-dialog.component.html&#x27;,
    styleUrls: [&#x27;./feature-info-dialog.component.css&#x27;]
})

export class FeatureInfoDialogComponent implements OnInit {

    itemList: string[];
    itemsLoaded: boolean[];
    itemsContent: string[];
    itemsExpanded: boolean[];
    itemsType: string[];

    selected: number &#x3D; 0;

    messages &#x3D; {
        noFeatureInfoData: &quot;No data available&quot;,
        featureInfoViewMore: &quot;View more&quot;
    };

    translateLabels() {
      this.messages[&quot;noFeatureInfoData&quot;] &#x3D; this.translate.instant(&quot;FEATURE_INFO_NO_DATA&quot;);
      this.messages[&quot;featureInfoViewMore&quot;] &#x3D; this.translate.instant(&quot;FEATURE_INFO_VIEW_MORE&quot;);
    }

    translate: TranslateService;
    constructor(
        private dialog: MatDialog,
        private dialogRef: MatDialogRef&lt;FeatureInfoDialogComponent&gt;,
        @Inject(MAT_DIALOG_DATA) private data:FeatureInfoDialogData,
        private http: HttpClient,
        translate: TranslateService) {
        this.translate &#x3D; translate;
        this.translate.onLangChange.subscribe(() &#x3D;&gt; {
            this.translateLabels();
        });
        this.translateLabels();
    }

    supportedTypes &#x3D; [
        &quot;text/plain&quot;,
        &quot;text/html&quot;,
        &quot;text/xml&quot;
    ];
    getSupportedResponseType(type:string) {
        var supportedType &#x3D; &quot;text/plain&quot;;
        if (type &amp;&amp; this.supportedTypes.indexOf(type.toLowerCase())!&#x3D;-1) {
            supportedType &#x3D; type;
        }
        return supportedType;

    }

    getElementsByTagNameNS(node, uri, name) {
        var elements &#x3D; [];
        if(node.getElementsByTagNameNS) {
            elements &#x3D; node.getElementsByTagNameNS(uri, name);
        } else {
            // brute force method
            var allNodes &#x3D; node.getElementsByTagName(&quot;*&quot;);
            var potentialNode, fullName;
            for(var i&#x3D;0, len&#x3D;allNodes.length; i&lt;len; ++i) {
                potentialNode &#x3D; allNodes[i];
                fullName &#x3D; (potentialNode.prefix) ?
                           (potentialNode.prefix + &quot;:&quot; + name) : name;
                if((name &#x3D;&#x3D; &quot;*&quot;) || (fullName &#x3D;&#x3D; potentialNode.nodeName)) {
                    if((uri &#x3D;&#x3D; &quot;*&quot;) || (uri &#x3D;&#x3D; potentialNode.namespaceURI)) {
                        elements.push(potentialNode);
                    }
                }
            }
        }
        return elements;
    }

    parseFeatureInfoResponse(data) {
        var response &#x3D; [];
        var featureNodes &#x3D; this.getElementsByTagNameNS(data, &#x27;*&#x27;,
            &#x27;FIELDS&#x27;);

        for(var i&#x3D;0, len&#x3D;featureNodes.length;i&lt;len;i++) {
            var featureNode &#x3D; featureNodes[i];
            var geom &#x3D; null;

            // attributes can be actual attributes on the FIELDS tag, 
            // or FIELD children
            var attributes &#x3D; {};
            var j;
            var jlen &#x3D; featureNode.attributes.length;
            if (jlen &gt; 0) {
                for(j&#x3D;0; j&lt;jlen; j++) {
                    var attribute &#x3D; featureNode.attributes[j];
                    attributes[attribute.nodeName] &#x3D; attribute.nodeValue;
                }
            } else {
                var nodes &#x3D; featureNode.childNodes;
                for (j&#x3D;0, jlen&#x3D;nodes.length; j&lt;jlen; ++j) {
                    var node &#x3D; nodes[j];
                    if (node.nodeType !&#x3D; 3) {
                        attributes[node.getAttribute(&quot;name&quot;)] &#x3D; 
                            node.getAttribute(&quot;value&quot;);
                    }
                }
            }

            response.push(
                //geom is always null
                new ol.Feature(attributes)
            );
        }
        return response;
    }

    showObjectInfo(msg) {
        this.openInfoDialog(msg);
    }

    isEventSupported &#x3D; (function(){
        var TAGNAMES &#x3D; {
          &#x27;select&#x27;:&#x27;input&#x27;,&#x27;change&#x27;:&#x27;input&#x27;,
          &#x27;submit&#x27;:&#x27;form&#x27;,&#x27;reset&#x27;:&#x27;form&#x27;,
          &#x27;error&#x27;:&#x27;img&#x27;,&#x27;load&#x27;:&#x27;img&#x27;,&#x27;abort&#x27;:&#x27;img&#x27;
        }
        function isEventSupported(eventName) {
          var el &#x3D; document.createElement(TAGNAMES[eventName] || &#x27;div&#x27;);
          eventName &#x3D; &#x27;on&#x27; + eventName;
          var isSupported &#x3D; (eventName in el);
          if (!isSupported) {
            el.setAttribute(eventName, &#x27;return;&#x27;);
            isSupported &#x3D; typeof el[eventName] &#x3D;&#x3D; &#x27;function&#x27;;
          }
          el &#x3D; null;
          return isSupported;
        }
        return isEventSupported;
      })();

    generateContent(type, response) {
        var result &#x3D; response;
        if (type &#x3D;&#x3D; &quot;text/xml&quot;) {
            try {
                var formatter &#x3D; new ol.format.WMSGetFeatureInfo();
                if (formatter) {

                    var doc &#x3D; new DOMParser().parseFromString(response, &#x27;application/xml&#x27;);
                    var features;
                    if (doc) {
                        var node &#x3D; doc.firstChild;
                        if (node &amp;&amp; node.localName &#x3D;&#x3D; &quot;FeatureInfoResponse&quot;) {
                            //parse FeatureInfoResponse nodes
                            features &#x3D; this.parseFeatureInfoResponse(node);
                        } else {
                            features &#x3D; formatter.readFeatures(doc);
                        }
                    }

                    if (features &amp;&amp; features.length) {
                        var div &#x3D; document.createElement(&quot;div&quot;);
                        var table &#x3D; document.createElement(&quot;table&quot;);
                        table.setAttribute(&quot;cellspacing&quot;, &quot;0&quot;);
                        div.appendChild(table);
                        var body &#x3D; document.createElement(&quot;tablebody&quot;);
                        table.appendChild(body);
                        var feature:ol.Feature;
                        var namesRow &#x3D; document.createElement(&quot;tr&quot;)
                        namesRow.className &#x3D; &quot;caption&quot;
                        body.appendChild(namesRow);
                        var row;
                        var td;
                        var properties;
                        var parsedValidFeatures &#x3D; 0;
                        var featureAttributes &#x3D; {};

                        //captions 
                        for (var i &#x3D; 0, iLen &#x3D; features.length; i &lt; iLen; i++) {
                            feature &#x3D; features[i];
                            //values row
                            properties &#x3D; feature.getProperties();
                            if (properties) {
                                for (var j in properties) {
                                    if (!featureAttributes[j]) {
                                        //Create name row
                                        td &#x3D; document.createElement(&quot;td&quot;);
                                        td.innerHTML &#x3D; j;
                                        namesRow.appendChild(td);
                                        featureAttributes[j] &#x3D; true;
                                    }
                                }
                            }
                        }
                        var this_ &#x3D; this;
                        var infoNode;
                        //values row
                        for (var i &#x3D; 0, iLen &#x3D; features.length; i &lt; iLen; i++) {
                            feature &#x3D; features[i];
                            properties &#x3D; feature.getProperties();
                            if (properties) {
                                row &#x3D; document.createElement(&quot;tr&quot;);
                                for (var j in featureAttributes) {
                                    td &#x3D; document.createElement(&quot;td&quot;);
                                    if (properties[j]) {
                                        //Show object information in an &#x27;alert type&#x27; dialog
                                        /*if ((properties[j] instanceof Object) &amp;&amp; 
                                            (j.toLowerCase() &#x3D;&#x3D; &quot;geometry&quot;)) {
                                            //infoNode &#x3D; document.createElement(&quot;span&quot;);
                                            //infoNode.className &#x3D; &quot;material-icons&quot;;
                                            //infoNode.innerHTML &#x3D; &quot;info&quot;;
                                            //infoNode.title &#x3D; this.messages[&quot;featureInfoViewMore&quot;];
                                            
                                            //if (this.isEventSupported(&#x27;touchstart&#x27;)) {
                                            //    infoNode.addEventListener(&#x27;touchstart&#x27;, function() {  
                                            //        this_.showObjectInfo(JSON.stringify(properties[j], null, 4));
                                            //      }, false);
                                            //} else {
                                            //    infoNode.addEventListener(&#x27;click&#x27;, function() {  
                                            //        this_.showObjectInfo(JSON.stringify(properties[j], null, 4));
                                            //      }, false);
                                            //}
                                            //td.appendChild(infoNode);
                                            //var value &#x3D; JSON.stringify({type: properties[j].getType(), coordinates: properties[j].getCoordinates()}, null, 4);
                                            td.innerHTML &#x3D; &#x27;&lt;span class&#x3D;&quot;material-icons object-info&quot; title&#x3D;&quot;&#x27; + value + 
                                                            &#x27;&quot; &gt;info&lt;/span&gt;&#x27;
                                        } else {*/
                                            td.innerHTML &#x3D; properties[j];
                                        //}
                                    } else {
                                        td.innerHTML &#x3D; &quot;&quot;;
                                    }
                                    row.appendChild(td);
                                }
                                body.appendChild(row);
                            }
                        }

                        result &#x3D; div.innerHTML;
                    } else {
                        result &#x3D; null;
                    }
                } else {
                    result &#x3D; response;
                }
            } catch (e) {
                console.log(e);
                result &#x3D; response;
            }           
        }
        return result;
    }

    generateErrorContent():string {
        return this.messages[&quot;noFeatureInfoData&quot;];
    }

    setItemLoaded(index, value) {
        if (index &lt; this.itemsLoaded.length) {
            this.itemsLoaded[index] &#x3D; value;
        }
    }

    getItemLoaded(index):boolean {
        if (index &lt; this.itemsLoaded.length) {
            return this.itemsLoaded[index];
        }
        return false;
    }

    getItemType(index):string {
        if (index &lt; this.itemsType.length) {
            return this.itemsType[index];
        }
        return &quot;text/plain&quot;;
    }

    setItemType(index, type) {
        if (index &lt; this.itemsType.length) {
            this.itemsType[index] &#x3D; this.getSupportedResponseType(type);
        }
    }

    getItemHTMLLoaded(index):boolean {
        return this.getItemLoaded(index) &amp;&amp; 
                (this.getItemType(index) !&#x3D; &quot;text/plain&quot;);
    }

    getItemTextLoaded(index):boolean {
        return this.getItemLoaded(index) &amp;&amp; 
                (this.getItemType(index) &#x3D;&#x3D; &quot;text/plain&quot;);
    }

    setItemContent(index, value) {
        if (index &lt; this.itemsContent.length) {
            if (value &#x3D;&#x3D; null) {
                this.setItemType(index, &quot;text/plain&quot;);
                this.itemsContent[index] &#x3D; this.generateErrorContent();
            } else {
                this.itemsContent[index] &#x3D; value;
            }
        }
    }

    getItemContent(index):string {
        if (index &lt; this.itemsContent.length) {
            return this.itemsContent[index];
        }
        return &quot;&quot;;
    }

    getItemExpanded(index):boolean {
        if (index &lt; this.itemsLoaded.length) {
            return this.itemsLoaded[index] &amp;&amp; this.itemsExpanded[index];
        }
        return false;
    }

    expandContent(index) {
        if (index &lt; this.itemsLoaded.length) {
            this.itemsExpanded[index] &#x3D; true;
        }
    }

    getItemCollapsed(index):boolean {
        if (index &lt; this.itemsLoaded.length) {
            return this.itemsLoaded[index] &amp;&amp; !this.itemsExpanded[index];
        }
        return false;
    }

    collapseContent(index) {
        if (index &lt; this.itemsLoaded.length) {
            this.itemsExpanded[index] &#x3D; false;
        }
    }

    getRequestData(request:string, index:number) {
        var options &#x3D; {};
        options[&quot;responseType&quot;] &#x3D; &quot;text&quot;;
        this.http.get(request, options).subscribe(res &#x3D;&gt; {
            //show content
            this.setItemContent(index, this.generateContent(this.getItemType(index), res));
        },
        error &#x3D;&gt; {
            this.setItemContent(index, null);
        },
        () &#x3D;&gt; {
            //hide loading
            this.setItemLoaded(index, true);
            this.expandContent(index);
        });
    }

    ngOnInit() {
        this.itemList &#x3D; [];
        this.itemsLoaded &#x3D; [];
        this.itemsContent &#x3D; [];
        this.itemsExpanded &#x3D; [];
        this.itemsType &#x3D; [];
        var request;
        var elementNode;
        for (var i &#x3D; 0, iLen &#x3D; this.data.requests.length; i &lt; iLen; i++) {
            this.itemList.push(this.data.requests[i].title?this.data.requests[i].title:i+&quot;&quot;);
            this.itemsLoaded.push(false);
            this.itemsExpanded.push(false);
            this.itemsContent.push(&quot;&quot;);
            request &#x3D; this.data.requests[i].request;
            if (request) {
                //Make the request
                this.itemsType.push(this.getSupportedResponseType(this.data.requests[i].type));
                this.getRequestData(request, i);
            }
        }
    }

    save() {
        this.dialogRef.close();
    }

    close() {
        this.dialogRef.close();
    }

    infoDialog:MatDialogRef&lt;MessageDialogComponent&gt;;
    openInfoDialog(title, message?) {
        if (title || message) {
            var data &#x3D; {
                title: message?title:null,
                message: message?message:title
            };
            this.infoDialog &#x3D; this.dialog.open(MessageDialogComponent,    {
                data: {
                    title: title,
                    message: message
                }
            });
        }
    }
}

export interface InfoDialogData {
    title: &quot;&quot;;
    message: &quot;&quot;;
  }

@Component({
    selector: &#x27;feature-info-message-dialog&#x27;,
    templateUrl: &#x27;feature-info-message-dialog.html&#x27;,
})
export class MessageDialogComponent {
    constructor(@Inject(MAT_DIALOG_DATA) public data: InfoDialogData) {}
}</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'InfoDialogData.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
